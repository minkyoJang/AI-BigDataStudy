# 6. 모듈

- *스크립트* 를 만든다고 한다.

- 함수를 각 프로그램에 복사하지 않고도 사용할 수 있다.

- 파이썬 정의와 문장들을 담고 있는 파일

- 모듈 내에서, 모듈의 이름은 전역 변수 `__name__`으로 제공

- **모듈을 import 한다고 해서 함수들의 이름이 현재 심볼 테이블에 들어가지 않는다.**

  - 모듈 이름만 들어간다.

  ```python
  >>> import fibo
  >>> fibo.__name__
  'fibo'
  ```

## 6.1. 모듈 더 보기

- 함수정의 뿐만 아니라 실행가능 문장도 포함할 수 있다
  - 모듈을 초기화할 때 사용
  - `import`문에서 모듈 이름이 *처음* 등장할 때만 실행된다
- 임포트되는 모듈 이름은 임포트하는 모듈의 전역 심볼 테이블에 들어감

```python
from fibo import fib, fib2
```

- 모듈에 들어있는 이름들을 직접 임포트
- 임포트되는 모듈의 이름을 만들지 않음
  - `fibo`가 정의되지 않는다.

```python
from fibo import *
```

- 밑줄(`_`)로 시작하는 것들을 제외한 모든 이름을 임포트
  - **주의!** 알려지지 않은 이름을 임포트하게 되어 이미 정의한 이름을 가릴 수 있다 

>효율성의 이유로, 각 모듈은 인터프리터마다 한 번만 임포트됩니다.
>
>`importlib.reload()`를 이용해서 수정된 모듈을 임포트 할 수 있다.

### 6.1.1 모듈을 스크립트로 실행하기

스크립트에서 다음과 같이 모듈을 실행하면

```shell
$ python fibo.py 50
0 1 1 2 3 5 8 13 21 34
```

- 모듈에 있는 코드는 임포트하는 것처럼 실행된다.
- `__name__`은 `"__main__"`으로 설정된다
  - 모듈이 "메인" 파일로 실행될 때만 명령행을 파싱하는 코드가 실행

```python
# 이 코드를 fibo 모듈의 끝에 붙여서 실행
if __name__ == "__main__":
    import sys
    fib(int(sys.argv[1]))
```

### 6.1.2 모듈 검색 경로

임포트 모듈 검색 순서는

1. 내장 모듈인가
2. sys.path에 있는 모듈인지
   - sys.path는
     - 입력 스크립트를 포함하는 디렉터리
     - PYTHONPATH
     - 설치 의존적인 기본 값

> 같은 이름일 경우 라이브러리 디렉터리 대신 스크립트를 포함하는 디렉터리가 로드된다.

### 6.1.3 "컴파일된" 파이썬 파일

- 모듈 로딩을 빠르게 하기 위해, 파이썬은 `__pycache__` 디렉터리에 각 모듈의 컴파일된 버전을 `module.version.pyc` 라는 이름으로 캐싱
- 캐시를 검사하지 않는 경우
  1. 명령행에서 직접 로드되는 모듈
  2. 소스 모듈이 없는 경우

## 6.2 표준 모듈들

- ex) `sys.ps1`과 `sys.ps2`는 기본과 보조 프롬프트로 사용되는 문자열을 정의
- `sys.path`는 인터프리터의 모듈 검색 경로를 결정하는 문자열들의 리스트
  - PYTHONPATH에서 취한 기본 경로
  - PYTHONPATH 설정하지 않은 경우 내장 기본값

## 6.3 dir() 함수

- `dir()`은 모듈이 정의하는 이름들을 찾는 데 사용

- 문자열들의 정렬된 리스트를 반환한다.
- 인자가 없으면 변수, 모듈, 함수 등 모든 형의 이름을 나열
- 내장 함수와 변수의 이름은 표준 모듈 `builtin`에 정의되어 있다.

## 6.4. 패키지

> "점으로 구분된 모듈 이름"을 써서 파이썬의 모듈 이름 공간을 구조화하는 방법

- ex) `A.B`는 `A`라는 패키지에 있는 `B` 라는 서브 모듈을 말한다.

- `__init__.py`는
  - 파일을 포함하는 디렉토리를 패키지로 처리하도록 함
- `from package import item`에서
  - item은 서브 모듈 / 서브 패키지 또는 함수, 클래스, 변수 등 다른 이름일 수 있다.
  - 먼저 패키지인지 검사 후 모듈이라고 가정하고 로드한다
- `import item.subitem.subsubitem`에서
  - 마지막 subsubitem을 제외한 각 항목은 반드시 패키지어야 한다.

### 6.4.1. 패키지에서 * 임포트 하기

`sound/effects/__init__.py` 에서

```python
__all__ = ["echo", "surround", "reverse"]
```

이면 `from sound.effects import *`는

sound.effects 패키지의 세 서브 모듈을 임포트하게 된다.

### 6.4.2 패키지 내부 간의 참조

- 상대 임포트를 사용할 수 있다. 현재 모듈의 이름에 기반을 둠

```python
from . import echo
from .. import formats
from ..filters import equalizer
```

### 6.4.3. 여러 디렉터리에 있는 패키지

`__path__` 

- `__init__.py`파일 실행 전, 파일이 들어있는 디렉터리의 이름을 포함하는 리스트로 초기화
- 이후 패키지에 포함된 모듈과 서브 패키지를 검색하는 데 영향을 주게 된다.